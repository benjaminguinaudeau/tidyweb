---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->
# tidyweb <img src="man/figures/tidyweb_logo.png" width="160px" align="right" />

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)

```

```{r, echo = FALSE, results='asis', eval = T}

library(badger)

git_repo <- "benjaminguinaudeau/tidyweb"

cat(
	badge_code_size(git_repo),
	badge_last_commit(git_repo)
)
```


This package is meant to ease web scraping with Selenium by "tidying" the html structure. To do so, it iterates recursively on web elements until a given depth and returns a tibble, with the children elements nested in list-columns. That way, tidy principles can be used to identify specific elements and eventually interact with them. 

## Install

```{r, message=FALSE}
# remotes::install_github("benjaminguinaudeau/tidyweb")
devtools::load_all()
```

## How to use? 

I like to use the [dockeR](http://github.com/benjaminguinaudeau/dockeR) package to use a Selenium server running in a docker container, but this will work with any driver generated from RSelenium. This only work if docker is installed on your computer and the deamon running.

```{r, eval = T, message=FALSE}
# remotes::install_github("benjaminguinaudeau/dockeR")
tidyweb::quiet(library(tidyverse))

chrome <- chrome_init("chrome", view = F, ua = NULL) # View param only works for mac
```

For this example, I will scrape the analysis provided by socialblade of CNN's youtube channel. 

```{r,eval = T, message=FALSE}
chrome %>% 
  open %>%
  go("https://socialblade.com/youtube/user/cnn")
```


```{r,eval = T}
body <- chrome %>%  elements("#socialblade-user-content")
body
```


## Lets start by exploring the first depth-level

```{r, eval = T}
depth_one <- body %>% tidy_element(1) %>% glimpse
depth_one$children_1[[1]] %>% glimpse
```


```{r, eval = T}
body <- chrome %>%  elements("#socialblade-user-content")
depth_three <- body %>% tidy_element(3) %>% glimpse
depth_three$children_3[[1]] %>% glimpse

```

```{r}
depth_three %>%
  select(contains("children")) %>%
  map_dfr(1) %>%
  filter(style %>% str_detect("color:#41a200;"))
  
```

